{% extends "core/base_bs.html" %}
{% load i18n staticfiles humanize currency %}

{% block page_title %}<title>{% trans "Mobile Money Checkout" %} - {{ service.project_name }} </title>{% endblock %}
{% block head_style %}
    {{ block.super }}
    <link rel='stylesheet' href="{% static 'ikwen/css/momo.css' %}" />
    <link rel='stylesheet' href="{% static 'kakocase/css/deals.css' %}" />
{% endblock %}

{% block content %}
    <div id="content" class="container">
        <div class="banks swiper-container">
            {% for bank in bank_list %}
                <div class="bank swiper-slide" data-bank-id="{{ bank.id }}"></div>
            {% endfor %}
        </div>
        {% for bank in bank_list %}
            <div class="deals row" id="{{ bank.id }}">
                <div class="col-sm-4 col-lg-3">
                    <div class="deal">
                        <h2 class="cost">
                            <span>{{ order.total_cost }}</span>
                            <sup class="currency">{{ CURRENCY.symbol }}</sup>
                        </h2>
                        <div class="description">
                            <p>{% trans "Pay Cash" %}</p>
                        </div>
                        <button class="btn btn-sm btn-warning cta btn-block choose" data-toggle="modal"
                                {% if user.is_anonymous %}data-target="#login-to-continue"{% endif %}
                                data-bank-id="{{ bank.id }}" data-id="{{ deal.id }}">{% trans "Confirm" %}</button>
                    </div>
                </div>
                {% for deal in bank.deal_list %}
                    <div class="col-sm-4 col-lg-3">
                        <div class="deal">
                            <h2 class="cost">
                                <span>{{ deal.term_cost }}</span>
                                <sup class="currency">{{ CURRENCY.symbol }}</sup>
                                <span>/</span>
                                <span>{%  trans deal.frequency %}</span>
                            </h2>
                            <div class="description">
                                <p>
                                    {% if deal.first_term %}
                                        <strong>{% trans "First Term" %}</strong>
                                        <span>{{ deal.first_term }}</span>
                                        <sup class="currency">CFA</sup>
                                    {% else %}
                                        <strong>{% trans "" %}</strong>
                                    {% endif %}
                                </p>
                                <p>{{ deal.about }}</p>
                            </div>
                            <button class="btn btn-sm btn-warning cta btn-block choose" data-toggle="modal"
                                    {% if user.is_anonymous %}data-target="#login-to-continue"{% endif %}
                                    data-bank-id="{{ bank.id }}" data-id="{{ deal.id }}">{% trans "Confirm" %}</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
    <div class="modal fade" id="confirm-checkout" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content modal-info">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">{% trans "Confirm" %}</h4>
                </div>
                <div class="modal-body">
                    <p class="col-xs-12" style="margin-bottom: 1em">{% trans "Confirm this purchase ?" %}</p>
                    <form method="post" action="{% url 'shopping:confirm_checkout' %}">{% csrf_token %}
                        <input type="hidden" id="bank-id" name="bank_id" />
                        <input type="hidden" id="deal-id" name="deal_id" />
                        <div class="col-xs-12 col-sm-4 col-md-3 pull-right">
                            <button type="submit"
                               class="btn btn-sm btn-success btn-block">{% trans "OK" %}</button>
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-3 pull-right">
                            <button type="button" class="btn btn-sm btn-danger btn-block"
                                    data-dismiss="modal" aria-label="Close">{% trans "Cancel" %}</button>
                        </div>
                    </form>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="login-to-continue" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content modal-info">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">{% trans "Sign in" %}</h4>
                </div>
                <div class="modal-body">
                    <p class="col-xs-12" style="margin-bottom: 1em">{% trans "Please sign in to continue" %}</p>
                    <div class="col-xs-12 col-sm-4 col-md-3 pull-right">
                        <a href="{% url 'ikwen:sign_in' %}next={{ request.META.REQUEST_URI }}"
                           class="btn btn-sm btn-success btn-block do-empty-cart">{% trans "Sign in" %}</a>
                    </div>
                    <div class="col-xs-12 col-sm-4 col-md-3 pull-right">
                        <a href="{% url 'ikwen:register' %}next={{ request.META.REQUEST_URI }}"
                           class="btn btn-sm btn-warning btn-block">{% trans "Register" %}</a>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js %}
    {{ block.super }}
    <script type="text/javascript">
        (function() {
            $('#content').on('click', '.deal .choose', function() {
                {% if user.is_authenticated %}
                    var bankId = $(this).data('bank-id'),
                        dealId = $(this).data('id');
                    $('#bank-id').val(bankId);
                    if (dealId) $('#deal-id').val(dealId);
                    $('#confirm-checkout').modal('show');
                {% endif %}
            })
        })()
    </script>
    {{ config.scripts|safe }}
{% endblock %}